<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SPY 대비 상위 종목</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.4/kakao.min.js"></script>
<style>
:root {
  --bg: #000000;
  --surface: #0a0a0a;
  --surface2: #111111;
  --border: #1a1a1a;
  --border-hover: #2a2a2a;
  --text: #e4e4e7;
  --text-dim: #71717a;
  --text-muted: #52525b;
  --green: #22c55e;
  --red: #ef4444;
  --cyan: #22d3ee;
  --blue: #4a90ff;
  --gold: #ffd644;
  --mono: 'JetBrains Mono', monospace;
  --sans: 'Noto Sans KR', -apple-system, sans-serif;
  --radius: 12px;
  --radius-sm: 8px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html { scrollbar-width: none; }
html::-webkit-scrollbar { display: none; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--sans);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

.container { max-width: 1400px; margin: 0 auto; }

/* ====== HEADER ====== */
.header {
  padding: 36px 20px 24px;
  text-align: center;
  border-bottom: 1px solid var(--border);
}

.header h1 {
  font-size: clamp(22px, 5vw, 36px);
  font-weight: 800;
  color: #fff;
  letter-spacing: -0.02em;
  margin-bottom: 6px;
}

.sub { font-size: 13px; color: var(--text-dim); }
.time { font-family: var(--mono); font-size: 11px; color: var(--text-muted); margin-top: 8px; }

/* ====== SHARE ====== */
.share-bar { display: flex; gap: 6px; justify-content: center; margin: 16px 0 4px; flex-wrap: wrap; }
.share-btn { display: flex; align-items: center; gap: 5px; padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-hover); background: var(--surface); color: #a1a1aa; font-size: 11px; cursor: pointer; font-family: var(--sans); transition: all 0.2s; }
.share-btn:hover { border-color: #444; color: var(--text); }
.share-btn svg { width: 14px; height: 14px; flex-shrink: 0; }
.share-btn.twitter:hover { border-color: #1d9bf0; color: #1d9bf0; }
.share-btn.kakao:hover { border-color: #fee500; color: #fee500; }
.share-btn.telegram:hover { border-color: #26a5e4; color: #26a5e4; }
.share-btn.instagram:hover { border-color: #e1306c; color: #e1306c; }
.share-btn.instagram.copied { border-color: var(--green); color: var(--green); }
.share-btn.copy:hover { border-color: var(--green); color: var(--green); }
.share-btn.copied { border-color: var(--green); color: var(--green); }

.toast { position: fixed; bottom: 20px; right: 20px; background: var(--green); color: #000; padding: 10px 16px; border-radius: var(--radius-sm); font-size: 13px; font-weight: 600; z-index: 9999; opacity: 0; transform: translateY(10px); transition: all 0.3s ease; pointer-events: none; }
.toast.show { opacity: 1; transform: translateY(0); }

/* ====== CONTROLS ====== */
.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  flex-wrap: wrap;
}

.spy-info {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font: 14px var(--mono);
}

.spy-label { color: var(--text-muted); }
.spy-value { font-weight: 600; color: var(--green); }
.spy-value.negative { color: var(--red); }

.period-buttons {
  display: flex;
  gap: 4px;
  background: var(--surface);
  border: 1px solid var(--border);
  padding: 4px;
  border-radius: var(--radius-sm);
}

.period-btn {
  padding: 8px 16px;
  border: none;
  background: transparent;
  color: var(--text-dim);
  font: 500 13px var(--sans);
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s;
  -webkit-tap-highlight-color: transparent;
}

.period-btn:hover { color: var(--text); }
.period-btn.active { background: var(--cyan); color: #000; font-weight: 600; }

/* ====== MAIN CONTENT ====== */
.main-content {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 16px;
  padding: 0 20px 16px;
  max-width: 1400px;
  margin: 0 auto;
}

/* ====== CHART ====== */
.chart-container {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  height: 500px;
  position: relative;
}

.chart-container::after {
  content: 'Herdvibe.com';
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  font: 700 28px var(--mono);
  color: rgba(255,255,255,0.04);
  pointer-events: none;
  z-index: 2;
  white-space: nowrap;
}

/* ====== TABLE ====== */
.table-container {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  max-height: 500px;
  display: flex;
  flex-direction: column;
}

.table-header {
  padding: 16px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

.table-title { font: 600 14px var(--sans); color: var(--text); }

.table-scroll { overflow-y: auto; flex: 1; scrollbar-width: none; }
.table-scroll::-webkit-scrollbar { display: none; }

table { width: 100%; border-collapse: collapse; }

th {
  text-align: left;
  padding: 10px 12px;
  font: 600 10px var(--mono);
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: var(--surface);
}

td {
  padding: 10px 12px;
  font-size: 12px;
  border-bottom: 1px solid var(--border);
}

tr { cursor: pointer; transition: all 0.2s; }
tr:hover { background: var(--surface2); }
tr.selected { background: rgba(34,211,238,0.08); }
tr.dimmed { opacity: 0.4; }

.rank { color: var(--text-muted); font: 500 12px var(--mono); width: 30px; }

.stock-info { display: flex; flex-direction: column; gap: 2px; }
.stock-symbol { font: 600 13px var(--mono); }
.stock-name { font-size: 10px; color: var(--text-muted); }

.perf-value { font: 600 12px var(--mono); text-align: right; }
.perf-value.positive { color: var(--green); }
.perf-value.negative { color: var(--red); }

.vs-spy { font: 11px var(--mono); text-align: right; }
.vs-spy.positive { color: var(--green); }
.vs-spy.negative { color: var(--red); }

/* ====== LEGEND ====== */
.legend {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 0 20px 20px;
  padding: 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font: 11px var(--mono);
  color: var(--text-dim);
  justify-content: center;
}

.legend-item { display: flex; align-items: center; gap: 4px; }
.legend-dot { width: 8px; height: 8px; border-radius: 50%; }
.legend-spy { width: 16px; height: 2px; border-top: 2px dashed var(--text-muted); }

/* ====== FOOTER ====== */
.footer {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 24px 40px;
  text-align: center;
  font-size: 10px;
  color: var(--text-muted);
}

/* ====== MOBILE ====== */
@media (max-width: 1100px) {
  .main-content { grid-template-columns: 1fr; }
}

@media (max-width: 768px) {
  .header { padding: 20px 16px 14px; }
  .header h1 { font-size: 22px; }
  .controls { padding: 12px 16px; gap: 8px; }
  .period-btn { padding: 8px 12px; font-size: 12px; }
  .main-content { padding: 0 12px 12px; gap: 10px; }
  .chart-container { height: 350px; padding: 14px; }
  .chart-container::after { font-size: 20px; }
  .table-container { max-height: 400px; }
  .legend { margin: 0 12px 16px; }
  .share-bar { margin: 12px 0 4px; }
  .footer { padding: 0 16px 30px; }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>SPY 대비 상위 종목</h1>
    <div class="sub">S&P 500 + Nasdaq 100 — SPY 수익률을 초과한 상위 20개 종목</div>
    <div class="time" id="updateTime">마지막 업데이트: 로딩중...</div>
  </div>

  <div class="share-bar">
    <button class="share-btn twitter" onclick="shareTwitter()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>트위터</button>
    <button class="share-btn kakao" onclick="shareKakao()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-5.52 0-10 3.36-10 7.5 0 2.66 1.74 5 4.36 6.33-.14.53-.9 3.4-.93 3.61 0 0-.02.17.09.23.11.07.24.03.24.03.32-.04 3.7-2.42 4.28-2.83.62.09 1.27.13 1.96.13 5.52 0 10-3.36 10-7.5S17.52 3 12 3z"/></svg>카카오톡</button>
    <button class="share-btn telegram" onclick="shareTelegram()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>텔레그램</button>
    <button class="share-btn instagram" onclick="shareInstagram(this)"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>인스타그램</button>
    <button class="share-btn copy" onclick="copyLink(this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>링크복사</button>
  </div>

  <div class="controls">
    <div class="spy-info">
      <span class="spy-label">SPY</span>
      <span class="spy-value" id="spy-perf">-</span>
    </div>
    <div class="period-buttons">
      <button class="period-btn" data-period="1W">1주</button>
      <button class="period-btn" data-period="1M">1개월</button>
      <button class="period-btn" data-period="3M">3개월</button>
      <button class="period-btn" data-period="12M">1년</button>
      <button class="period-btn active" data-period="YTD">YTD</button>
    </div>
  </div>

  <div class="main-content">
    <div class="chart-container">
      <canvas id="perfChart"></canvas>
    </div>
    <div class="table-container">
      <div class="table-header">
        <div class="table-title">상위 20 종목</div>
      </div>
      <div class="table-scroll">
        <table>
          <thead>
            <tr><th>#</th><th>종목</th><th style="text-align:right">수익률</th><th style="text-align:right">vs SPY</th></tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="legend" id="legend"></div>
  <div class="footer">데이터 출처: Yahoo Finance · S&P 500 + Nasdaq 100 기준 · 투자 판단은 본인의 책임입니다</div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ====== SHARE ====== */
const SHARE_URL = 'https://herdvibe.com/spy-outperformers';
const SHARE_TITLE = 'SPY 대비 상위 종목 — Herdvibe';
const SHARE_DESC = 'S&P 500 + Nasdaq 100 SPY 초과 수익 상위 20 종목 | Herdvibe';

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}
function shareTwitter() { window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(SHARE_TITLE)}&url=${encodeURIComponent(SHARE_URL)}`, '_blank'); }
function shareKakao() {
  if (window.Kakao && !Kakao.isInitialized()) Kakao.init('a43ed7b39fac35458f4f9df925a279b5');
  if (window.Kakao) { Kakao.Share.sendDefault({ objectType:'feed', content:{ title:SHARE_TITLE, description:SHARE_DESC, imageUrl:'https://herdvibe.com/og-spy.png', link:{ mobileWebUrl:SHARE_URL, webUrl:SHARE_URL } } }); }
}
function shareTelegram() { window.open(`https://t.me/share/url?url=${encodeURIComponent(SHARE_URL)}&text=${encodeURIComponent(SHARE_TITLE)}`, '_blank'); }
function shareInstagram(btn) {
  try {
    if (window.parent !== window) window.parent.postMessage({ type:'copy', text:SHARE_URL }, '*');
    else navigator.clipboard.writeText(SHARE_URL);
    const orig = btn.innerHTML; btn.classList.add('copied');
    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>복사됨!';
    showToast('링크가 복사되었습니다 - 인스타그램에 붙여넣기 하세요');
    setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = orig; }, 2000);
  } catch(e) { showToast('복사 실패'); }
}
function copyLink(btn) {
  try {
    if (window.parent !== window) window.parent.postMessage({ type:'copy', text:SHARE_URL }, '*');
    else navigator.clipboard.writeText(SHARE_URL);
    const orig = btn.innerHTML; btn.classList.add('copied');
    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>복사됨!';
    showToast('링크가 복사되었습니다');
    setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = orig; }, 2000);
  } catch(e) { showToast('복사 실패'); }
}

/* ====== SAMPLE DATA (fallback) ====== */
const SAMPLE_SPY = {"prices": [{"date": "2025-01-02", "price": 580.12}, {"date": "2025-01-15", "price": 585.34}, {"date": "2025-02-01", "price": 592.67}, {"date": "2025-02-15", "price": 598.9}, {"date": "2025-03-01", "price": 605.23}, {"date": "2025-03-15", "price": 612.12}, {"date": "2025-04-01", "price": 618.45}, {"date": "2025-04-15", "price": 625.9}, {"date": "2025-05-01", "price": 632.23}, {"date": "2025-05-15", "price": 638.12}, {"date": "2025-06-01", "price": 645.45}, {"date": "2025-06-15", "price": 652.9}, {"date": "2025-07-01", "price": 658.23}, {"date": "2025-07-15", "price": 665.12}, {"date": "2025-08-01", "price": 660.45}, {"date": "2025-08-15", "price": 668.9}, {"date": "2025-09-01", "price": 675.23}, {"date": "2025-09-15", "price": 682.12}, {"date": "2025-10-01", "price": 688.45}, {"date": "2025-10-15", "price": 695.9}, {"date": "2025-11-01", "price": 702.23}, {"date": "2025-11-15", "price": 708.12}, {"date": "2025-12-01", "price": 715.45}, {"date": "2025-12-15", "price": 722.9}, {"date": "2026-01-02", "price": 728.23}, {"date": "2026-01-08", "price": 732.12}, {"date": "2026-01-15", "price": 738.45}, {"date": "2026-01-22", "price": 745.9}, {"date": "2026-01-28", "price": 752.23}], "performance": {"1W": 1.2, "1M": 3.3, "3M": 8.5, "12M": 29.7, "YTD": 3.3}};
const SAMPLE_STOCKS = [{"symbol": "NVDA", "prices": [{"date": "2025-01-02", "price": 480.12}, {"date": "2025-02-01", "price": 520.34}, {"date": "2025-03-01", "price": 565.67}, {"date": "2025-04-01", "price": 612.9}, {"date": "2025-05-01", "price": 658.23}, {"date": "2025-06-01", "price": 705.12}, {"date": "2025-07-01", "price": 752.45}, {"date": "2025-08-01", "price": 738.9}, {"date": "2025-09-01", "price": 798.23}, {"date": "2025-10-01", "price": 845.12}, {"date": "2025-11-01", "price": 892.45}, {"date": "2025-12-01", "price": 938.9}, {"date": "2026-01-02", "price": 972.23}, {"date": "2026-01-15", "price": 1015.12}, {"date": "2026-01-28", "price": 1058.45}], "performance": {"1W": 4.5, "1M": 8.9, "3M": 26.2, "12M": 120.4, "YTD": 8.9}}, {"symbol": "META", "prices": [{"date": "2025-01-02", "price": 520.12}, {"date": "2025-02-01", "price": 545.34}, {"date": "2025-03-01", "price": 572.67}, {"date": "2025-04-01", "price": 598.9}, {"date": "2025-05-01", "price": 625.23}, {"date": "2025-06-01", "price": 652.12}, {"date": "2025-07-01", "price": 678.45}, {"date": "2025-08-01", "price": 665.9}, {"date": "2025-09-01", "price": 705.23}, {"date": "2025-10-01", "price": 732.12}, {"date": "2025-11-01", "price": 758.45}, {"date": "2025-12-01", "price": 785.9}, {"date": "2026-01-02", "price": 812.23}, {"date": "2026-01-15", "price": 845.12}, {"date": "2026-01-28", "price": 878.45}], "performance": {"1W": 3.8, "1M": 7.8, "3M": 19.5, "12M": 68.9, "YTD": 8.1}}, {"symbol": "AVGO", "prices": [{"date": "2025-01-02", "price": 180.12}, {"date": "2025-02-01", "price": 192.34}, {"date": "2025-03-01", "price": 205.67}, {"date": "2025-04-01", "price": 218.9}, {"date": "2025-05-01", "price": 232.23}, {"date": "2025-06-01", "price": 245.12}, {"date": "2025-07-01", "price": 258.45}, {"date": "2025-08-01", "price": 252.9}, {"date": "2025-09-01", "price": 272.23}, {"date": "2025-10-01", "price": 285.12}, {"date": "2025-11-01", "price": 298.45}, {"date": "2025-12-01", "price": 312.9}, {"date": "2026-01-02", "price": 325.23}, {"date": "2026-01-15", "price": 342.12}, {"date": "2026-01-28", "price": 358.45}], "performance": {"1W": 4.2, "1M": 9.2, "3M": 26.8, "12M": 99.0, "YTD": 10.2}}, {"symbol": "AMD", "prices": [{"date": "2025-01-02", "price": 145.12}, {"date": "2025-02-01", "price": 152.34}, {"date": "2025-03-01", "price": 162.67}, {"date": "2025-04-01", "price": 172.9}, {"date": "2025-05-01", "price": 182.23}, {"date": "2025-06-01", "price": 192.12}, {"date": "2025-07-01", "price": 202.45}, {"date": "2025-08-01", "price": 195.9}, {"date": "2025-09-01", "price": 212.23}, {"date": "2025-10-01", "price": 222.12}, {"date": "2025-11-01", "price": 232.45}, {"date": "2025-12-01", "price": 242.9}, {"date": "2026-01-02", "price": 252.23}, {"date": "2026-01-15", "price": 265.12}, {"date": "2026-01-28", "price": 278.45}], "performance": {"1W": 4.8, "1M": 10.2, "3M": 27.5, "12M": 91.9, "YTD": 10.4}}, {"symbol": "TSLA", "prices": [{"date": "2025-01-02", "price": 252.12}, {"date": "2025-02-01", "price": 268.34}, {"date": "2025-03-01", "price": 285.67}, {"date": "2025-04-01", "price": 302.9}, {"date": "2025-05-01", "price": 318.23}, {"date": "2025-06-01", "price": 335.12}, {"date": "2025-07-01", "price": 352.45}, {"date": "2025-08-01", "price": 338.9}, {"date": "2025-09-01", "price": 368.23}, {"date": "2025-10-01", "price": 385.12}, {"date": "2025-11-01", "price": 402.45}, {"date": "2025-12-01", "price": 418.9}, {"date": "2026-01-02", "price": 432.23}, {"date": "2026-01-15", "price": 455.12}, {"date": "2026-01-28", "price": 478.45}], "performance": {"1W": 5.2, "1M": 10.5, "3M": 24.5, "12M": 89.8, "YTD": 10.7}}, {"symbol": "PLTR", "prices": [{"date": "2025-01-02", "price": 18.12}, {"date": "2025-02-01", "price": 20.34}, {"date": "2025-03-01", "price": 22.67}, {"date": "2025-04-01", "price": 24.9}, {"date": "2025-05-01", "price": 27.23}, {"date": "2025-06-01", "price": 29.12}, {"date": "2025-07-01", "price": 31.45}, {"date": "2025-08-01", "price": 30.9}, {"date": "2025-09-01", "price": 34.23}, {"date": "2025-10-01", "price": 36.12}, {"date": "2025-11-01", "price": 38.45}, {"date": "2025-12-01", "price": 40.9}, {"date": "2026-01-02", "price": 42.23}, {"date": "2026-01-15", "price": 45.12}, {"date": "2026-01-28", "price": 48.45}], "performance": {"1W": 6.5, "1M": 14.2, "3M": 34.2, "12M": 167.4, "YTD": 14.7}}, {"symbol": "SMCI", "prices": [{"date": "2025-01-02", "price": 32.12}, {"date": "2025-02-01", "price": 38.34}, {"date": "2025-03-01", "price": 45.67}, {"date": "2025-04-01", "price": 52.9}, {"date": "2025-05-01", "price": 58.23}, {"date": "2025-06-01", "price": 65.12}, {"date": "2025-07-01", "price": 72.45}, {"date": "2025-08-01", "price": 68.9}, {"date": "2025-09-01", "price": 78.23}, {"date": "2025-10-01", "price": 85.12}, {"date": "2025-11-01", "price": 92.45}, {"date": "2025-12-01", "price": 98.9}, {"date": "2026-01-02", "price": 105.23}, {"date": "2026-01-15", "price": 115.12}, {"date": "2026-01-28", "price": 125.45}], "performance": {"1W": 7.2, "1M": 18.5, "3M": 47.2, "12M": 290.5, "YTD": 19.2}}, {"symbol": "MSTR", "prices": [{"date": "2025-01-02", "price": 485.12}, {"date": "2025-02-01", "price": 545.34}, {"date": "2025-03-01", "price": 612.67}, {"date": "2025-04-01", "price": 678.9}, {"date": "2025-05-01", "price": 745.23}, {"date": "2025-06-01", "price": 812.12}, {"date": "2025-07-01", "price": 878.45}, {"date": "2025-08-01", "price": 845.9}, {"date": "2025-09-01", "price": 945.23}, {"date": "2025-10-01", "price": 1012.12}, {"date": "2025-11-01", "price": 1078.45}, {"date": "2025-12-01", "price": 1145.9}, {"date": "2026-01-02", "price": 1212.23}, {"date": "2026-01-15", "price": 1315.12}, {"date": "2026-01-28", "price": 1418.45}], "performance": {"1W": 7.8, "1M": 16.5, "3M": 50.2, "12M": 192.4, "YTD": 17.0}}, {"symbol": "CRWD", "prices": [{"date": "2025-01-02", "price": 285.12}, {"date": "2025-02-01", "price": 305.34}, {"date": "2025-03-01", "price": 328.67}, {"date": "2025-04-01", "price": 352.9}, {"date": "2025-05-01", "price": 375.23}, {"date": "2025-06-01", "price": 398.12}, {"date": "2025-07-01", "price": 422.45}, {"date": "2025-08-01", "price": 412.9}, {"date": "2025-09-01", "price": 448.23}, {"date": "2025-10-01", "price": 472.12}, {"date": "2025-11-01", "price": 495.45}, {"date": "2025-12-01", "price": 518.9}, {"date": "2026-01-02", "price": 542.23}, {"date": "2026-01-15", "price": 572.12}, {"date": "2026-01-28", "price": 602.45}], "performance": {"1W": 5.2, "1M": 10.8, "3M": 27.5, "12M": 111.3, "YTD": 11.1}}, {"symbol": "COIN", "prices": [{"date": "2025-01-02", "price": 178.12}, {"date": "2025-02-01", "price": 198.34}, {"date": "2025-03-01", "price": 222.67}, {"date": "2025-04-01", "price": 248.9}, {"date": "2025-05-01", "price": 272.23}, {"date": "2025-06-01", "price": 298.12}, {"date": "2025-07-01", "price": 322.45}, {"date": "2025-08-01", "price": 308.9}, {"date": "2025-09-01", "price": 348.23}, {"date": "2025-10-01", "price": 372.12}, {"date": "2025-11-01", "price": 398.45}, {"date": "2025-12-01", "price": 422.9}, {"date": "2026-01-02", "price": 448.23}, {"date": "2026-01-15", "price": 485.12}, {"date": "2026-01-28", "price": 522.45}], "performance": {"1W": 7.5, "1M": 16.2, "3M": 49.8, "12M": 193.4, "YTD": 16.6}}, {"symbol": "NFLX", "prices": [{"date": "2025-01-02", "price": 485.12}, {"date": "2025-02-01", "price": 512.34}, {"date": "2025-03-01", "price": 542.67}, {"date": "2025-04-01", "price": 572.9}, {"date": "2025-05-01", "price": 602.23}, {"date": "2025-06-01", "price": 632.12}, {"date": "2025-07-01", "price": 662.45}, {"date": "2025-08-01", "price": 648.9}, {"date": "2025-09-01", "price": 695.23}, {"date": "2025-10-01", "price": 725.12}, {"date": "2025-11-01", "price": 755.45}, {"date": "2025-12-01", "price": 785.9}, {"date": "2026-01-02", "price": 815.23}, {"date": "2026-01-15", "price": 858.12}, {"date": "2026-01-28", "price": 902.45}], "performance": {"1W": 5.0, "1M": 10.2, "3M": 29.8, "12M": 86.0, "YTD": 10.7}}, {"symbol": "AMZN", "prices": [{"date": "2025-01-02", "price": 185.12}, {"date": "2025-02-01", "price": 192.34}, {"date": "2025-03-01", "price": 200.67}, {"date": "2025-04-01", "price": 208.9}, {"date": "2025-05-01", "price": 217.23}, {"date": "2025-06-01", "price": 225.12}, {"date": "2025-07-01", "price": 233.45}, {"date": "2025-08-01", "price": 228.9}, {"date": "2025-09-01", "price": 242.23}, {"date": "2025-10-01", "price": 250.12}, {"date": "2025-11-01", "price": 258.45}, {"date": "2025-12-01", "price": 266.9}, {"date": "2026-01-02", "price": 275.23}, {"date": "2026-01-15", "price": 286.12}, {"date": "2026-01-28", "price": 297.45}], "performance": {"1W": 3.8, "1M": 7.8, "3M": 22.5, "12M": 60.7, "YTD": 8.1}}, {"symbol": "GOOGL", "prices": [{"date": "2025-01-02", "price": 142.12}, {"date": "2025-02-01", "price": 148.34}, {"date": "2025-03-01", "price": 155.67}, {"date": "2025-04-01", "price": 162.9}, {"date": "2025-05-01", "price": 170.23}, {"date": "2025-06-01", "price": 177.12}, {"date": "2025-07-01", "price": 184.45}, {"date": "2025-08-01", "price": 180.9}, {"date": "2025-09-01", "price": 192.23}, {"date": "2025-10-01", "price": 199.12}, {"date": "2025-11-01", "price": 206.45}, {"date": "2025-12-01", "price": 213.9}, {"date": "2026-01-02", "price": 221.23}, {"date": "2026-01-15", "price": 230.12}, {"date": "2026-01-28", "price": 239.45}], "performance": {"1W": 3.9, "1M": 8.0, "3M": 24.5, "12M": 68.5, "YTD": 8.2}}, {"symbol": "MSFT", "prices": [{"date": "2025-01-02", "price": 378.12}, {"date": "2025-02-01", "price": 392.34}, {"date": "2025-03-01", "price": 408.67}, {"date": "2025-04-01", "price": 424.9}, {"date": "2025-05-01", "price": 440.23}, {"date": "2025-06-01", "price": 456.12}, {"date": "2025-07-01", "price": 472.45}, {"date": "2025-08-01", "price": 462.9}, {"date": "2025-09-01", "price": 492.23}, {"date": "2025-10-01", "price": 508.12}, {"date": "2025-11-01", "price": 524.45}, {"date": "2025-12-01", "price": 540.9}, {"date": "2026-01-02", "price": 556.23}, {"date": "2026-01-15", "price": 578.12}, {"date": "2026-01-28", "price": 600.45}], "performance": {"1W": 3.8, "1M": 7.8, "3M": 22.0, "12M": 58.8, "YTD": 7.9}}, {"symbol": "AAPL", "prices": [{"date": "2025-01-02", "price": 192.12}, {"date": "2025-02-01", "price": 198.34}, {"date": "2025-03-01", "price": 205.67}, {"date": "2025-04-01", "price": 212.9}, {"date": "2025-05-01", "price": 219.23}, {"date": "2025-06-01", "price": 226.12}, {"date": "2025-07-01", "price": 232.45}, {"date": "2025-08-01", "price": 228.9}, {"date": "2025-09-01", "price": 240.23}, {"date": "2025-10-01", "price": 247.12}, {"date": "2025-11-01", "price": 254.45}, {"date": "2025-12-01", "price": 261.9}, {"date": "2026-01-02", "price": 268.23}, {"date": "2026-01-15", "price": 278.12}, {"date": "2026-01-28", "price": 288.45}], "performance": {"1W": 3.6, "1M": 7.2, "3M": 19.8, "12M": 50.1, "YTD": 7.5}}, {"symbol": "LLY", "prices": [{"date": "2025-01-02", "price": 785.12}, {"date": "2025-02-01", "price": 815.34}, {"date": "2025-03-01", "price": 848.67}, {"date": "2025-04-01", "price": 882.9}, {"date": "2025-05-01", "price": 915.23}, {"date": "2025-06-01", "price": 948.12}, {"date": "2025-07-01", "price": 982.45}, {"date": "2025-08-01", "price": 965.9}, {"date": "2025-09-01", "price": 1015.23}, {"date": "2025-10-01", "price": 1048.12}, {"date": "2025-11-01", "price": 1082.45}, {"date": "2025-12-01", "price": 1115.9}, {"date": "2026-01-02", "price": 1148.23}, {"date": "2026-01-15", "price": 1195.12}, {"date": "2026-01-28", "price": 1242.45}], "performance": {"1W": 3.8, "1M": 8.0, "3M": 22.2, "12M": 58.3, "YTD": 8.2}}, {"symbol": "PANW", "prices": [{"date": "2025-01-02", "price": 325.12}, {"date": "2025-02-01", "price": 348.34}, {"date": "2025-03-01", "price": 375.67}, {"date": "2025-04-01", "price": 402.9}, {"date": "2025-05-01", "price": 428.23}, {"date": "2025-06-01", "price": 455.12}, {"date": "2025-07-01", "price": 482.45}, {"date": "2025-08-01", "price": 468.9}, {"date": "2025-09-01", "price": 512.23}, {"date": "2025-10-01", "price": 538.12}, {"date": "2025-11-01", "price": 565.45}, {"date": "2025-12-01", "price": 592.9}, {"date": "2026-01-02", "price": 618.23}, {"date": "2026-01-15", "price": 655.12}, {"date": "2026-01-28", "price": 692.45}], "performance": {"1W": 5.5, "1M": 11.5, "3M": 35.2, "12M": 113.0, "YTD": 12.0}}, {"symbol": "NOW", "prices": [{"date": "2025-01-02", "price": 712.12}, {"date": "2025-02-01", "price": 748.34}, {"date": "2025-03-01", "price": 788.67}, {"date": "2025-04-01", "price": 828.9}, {"date": "2025-05-01", "price": 868.23}, {"date": "2025-06-01", "price": 908.12}, {"date": "2025-07-01", "price": 948.45}, {"date": "2025-08-01", "price": 928.9}, {"date": "2025-09-01", "price": 988.23}, {"date": "2025-10-01", "price": 1028.12}, {"date": "2025-11-01", "price": 1068.45}, {"date": "2025-12-01", "price": 1108.9}, {"date": "2026-01-02", "price": 1148.23}, {"date": "2026-01-15", "price": 1202.12}, {"date": "2026-01-28", "price": 1256.45}], "performance": {"1W": 4.5, "1M": 9.2, "3M": 27.2, "12M": 76.4, "YTD": 9.4}}, {"symbol": "CRM", "prices": [{"date": "2025-01-02", "price": 268.12}, {"date": "2025-02-01", "price": 282.34}, {"date": "2025-03-01", "price": 298.67}, {"date": "2025-04-01", "price": 315.9}, {"date": "2025-05-01", "price": 332.23}, {"date": "2025-06-01", "price": 348.12}, {"date": "2025-07-01", "price": 365.45}, {"date": "2025-08-01", "price": 358.9}, {"date": "2025-09-01", "price": 385.23}, {"date": "2025-10-01", "price": 402.12}, {"date": "2025-11-01", "price": 418.45}, {"date": "2025-12-01", "price": 435.9}, {"date": "2026-01-02", "price": 452.23}, {"date": "2026-01-15", "price": 475.12}, {"date": "2026-01-28", "price": 498.45}], "performance": {"1W": 4.8, "1M": 10.0, "3M": 29.2, "12M": 85.9, "YTD": 10.2}}, {"symbol": "UBER", "prices": [{"date": "2025-01-02", "price": 62.12}, {"date": "2025-02-01", "price": 66.34}, {"date": "2025-03-01", "price": 71.67}, {"date": "2025-04-01", "price": 76.9}, {"date": "2025-05-01", "price": 82.23}, {"date": "2025-06-01", "price": 87.12}, {"date": "2025-07-01", "price": 92.45}, {"date": "2025-08-01", "price": 89.9}, {"date": "2025-09-01", "price": 98.23}, {"date": "2025-10-01", "price": 103.12}, {"date": "2025-11-01", "price": 108.45}, {"date": "2025-12-01", "price": 113.9}, {"date": "2026-01-02", "price": 118.23}, {"date": "2026-01-15", "price": 125.12}, {"date": "2026-01-28", "price": 132.45}], "performance": {"1W": 5.5, "1M": 11.8, "3M": 34.8, "12M": 113.2, "YTD": 12.0}}];
const SAMPLE_NAMES = {"NVDA": "NVIDIA Corporation", "META": "Meta Platforms Inc", "AVGO": "Broadcom Inc", "AMD": "Advanced Micro Devices", "TSLA": "Tesla Inc", "PLTR": "Palantir Technologies", "SMCI": "Super Micro Computer", "MSTR": "MicroStrategy Inc", "CRWD": "CrowdStrike Holdings", "COIN": "Coinbase Global Inc", "NFLX": "Netflix Inc", "AMZN": "Amazon.com Inc", "GOOGL": "Alphabet Inc", "MSFT": "Microsoft Corporation", "AAPL": "Apple Inc", "LLY": "Eli Lilly and Company", "PANW": "Palo Alto Networks", "NOW": "ServiceNow Inc", "CRM": "Salesforce Inc", "UBER": "Uber Technologies"};

const COLORS = [
  '#3b82f6','#ef4444','#22c55e','#f59e0b','#8b5cf6',
  '#06b6d4','#ec4899','#84cc16','#f97316','#14b8a6',
  '#a855f7','#eab308','#64748b','#dc2626','#0891b2',
  '#c026d3','#e11d48','#ea580c','#16a34a','#2563eb'
];

let SPY_DATA, STOCKS_DATA, STOCK_NAMES;
let currentPeriod = 'YTD';
let chart = null;
let top20 = [];
let selectedStock = null;

function getStartDate(period) {
  const now = new Date();
  switch(period) {
    case '1W': return new Date(now - 7*864e5);
    case '1M': return new Date(now - 30*864e5);
    case '3M': return new Date(now - 90*864e5);
    case '12M': return new Date(now - 365*864e5);
    case 'YTD': return new Date(now.getFullYear(), 0, 1);
    default: return new Date(now.getFullYear(), 0, 1);
  }
}

function calculatePercentChange(prices, startDate) {
  const startStr = startDate.toISOString().split('T')[0];
  const filtered = prices.filter(p => p.date >= startStr);
  if (!filtered.length) return [];
  const base = filtered[0].price;
  return filtered.map(p => ({ x: p.date, y: ((p.price - base) / base * 100) }));
}

function getTop20(period) {
  const spyPerf = SPY_DATA.performance[period] || 0;
  return STOCKS_DATA
    .filter(s => s.performance && s.performance[period] !== undefined)
    .map(s => ({ ...s, vsSpy: s.performance[period] - spyPerf }))
    .sort((a, b) => b.vsSpy - a.vsSpy)
    .slice(0, 20);
}

function updateChart() {
  const startDate = getStartDate(currentPeriod);
  const datasets = [];

  const spyData = calculatePercentChange(SPY_DATA.prices, startDate);
  datasets.push({
    label: 'SPY', data: spyData, borderColor: '#52525b',
    borderWidth: 2, borderDash: [5,5], pointRadius: 0, tension: 0.1, fill: false
  });

  top20.forEach((stock, i) => {
    const d = calculatePercentChange(stock.prices, startDate);
    if (!d.length) return;
    let bw = 2, bc = COLORS[i % COLORS.length];
    if (selectedStock) {
      if (stock.symbol === selectedStock) bw = 4;
      else { bw = 1; bc = COLORS[i % COLORS.length] + '40'; }
    }
    datasets.push({
      label: stock.symbol, data: d, borderColor: bc,
      borderWidth: bw, pointRadius: 0, tension: 0.1, fill: false
    });
  });

  if (chart) { chart.data.datasets = datasets; chart.update('none'); }
  else {
    chart = new Chart(document.getElementById('perfChart').getContext('2d'), {
      type: 'line', data: { datasets },
      options: {
        responsive: true, maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: '#18181b', titleColor: '#fff', bodyColor: '#a1a1aa',
            borderColor: '#2a2a2a', borderWidth: 1, padding: 10,
            bodyFont: { family: "'JetBrains Mono', monospace", size: 11 },
            titleFont: { family: "'JetBrains Mono', monospace", size: 11 },
            callbacks: { label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y >= 0?'+':''}${ctx.parsed.y.toFixed(2)}%` }
          }
        },
        scales: {
          x: {
            type: 'time',
            time: {
              unit: currentPeriod==='1W'?'day':currentPeriod==='1M'?'week':'month',
              displayFormats: { day:'MM/dd', week:'MM/dd', month:'yy/MM' }
            },
            grid: { color: '#1a1a1a' },
            ticks: { color: '#52525b', font: { family: "'JetBrains Mono', monospace", size: 10 } }
          },
          y: {
            grid: { color: '#1a1a1a' },
            ticks: {
              color: '#52525b',
              font: { family: "'JetBrains Mono', monospace", size: 10 },
              callback: v => v + '%'
            }
          }
        }
      }
    });
  }
}

function updateTable() {
  const spyPerf = SPY_DATA.performance[currentPeriod] || 0;
  const spyEl = document.getElementById('spy-perf');
  spyEl.textContent = (spyPerf>=0?'+':'') + spyPerf.toFixed(2) + '%';
  spyEl.className = 'spy-value ' + (spyPerf>=0?'':'negative');

  document.getElementById('table-body').innerHTML = top20.map((s, i) => {
    const perf = s.performance[currentPeriod];
    const name = STOCK_NAMES[s.symbol] || s.symbol;
    const isSel = selectedStock === s.symbol;
    const isDim = selectedStock && !isSel;
    return `<tr data-symbol="${s.symbol}" class="${isSel?'selected':''} ${isDim?'dimmed':''}">
      <td class="rank">${i+1}</td>
      <td><div class="stock-info"><span class="stock-symbol" style="color:${COLORS[i%COLORS.length]}">${s.symbol}</span><span class="stock-name">${name.substring(0,25)}</span></div></td>
      <td class="perf-value ${perf>=0?'positive':'negative'}">${perf>=0?'+':''}${perf.toFixed(2)}%</td>
      <td class="vs-spy ${s.vsSpy>=0?'positive':'negative'}">${s.vsSpy>=0?'+':''}${s.vsSpy.toFixed(2)}%</td>
    </tr>`;
  }).join('');

  document.getElementById('table-body').querySelectorAll('tr').forEach(row => {
    row.addEventListener('click', () => {
      selectedStock = selectedStock === row.dataset.symbol ? null : row.dataset.symbol;
      updateChart(); updateTable();
    });
  });
}

function updateLegend() {
  document.getElementById('legend').innerHTML =
    '<div class="legend-item"><div class="legend-spy"></div><span>SPY</span></div>' +
    top20.map((s, i) => `<div class="legend-item"><div class="legend-dot" style="background:${COLORS[i%COLORS.length]}"></div><span>${s.symbol}</span></div>`).join('');
}

function fullUpdate() {
  top20 = getTop20(currentPeriod);
  selectedStock = null;
  updateChart(); updateTable(); updateLegend();
}

document.querySelectorAll('.period-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentPeriod = btn.dataset.period;
    fullUpdate();
  });
});

async function load() {
  try {
    const res = await fetch('data/stocks.json');
    if (!res.ok) throw new Error();
    const data = await res.json();
    SPY_DATA = data.spy;
    STOCKS_DATA = data.stocks;
    STOCK_NAMES = data.names || SAMPLE_NAMES;
    document.getElementById('updateTime').textContent = `마지막 업데이트: ${data.updated || ''}`;
  } catch(e) {
    SPY_DATA = SAMPLE_SPY;
    STOCKS_DATA = SAMPLE_STOCKS;
    STOCK_NAMES = SAMPLE_NAMES;
    document.getElementById('updateTime').textContent = '샘플 데이터';
  }
  fullUpdate();
}
load();
</script>
</body>
</html>
